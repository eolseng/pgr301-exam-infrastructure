language: bash
cache:
  directories:
    - "$HOME/bin/terraform/"
env:
  global:
    - TF_VAR_project_name="pgr301-exam-10004"
    - TF_VAR_project_region="europe-north1"
    - TF_VAR_auth_app_image="eu.gcr.io/pgr301-exam-10004/pgr301-exam-auth"
    - TF_VAR_auth_app_tag="a42c68a24094b2d5ca532222fa447ef985566025"
    - TF_VERSION=0.13.5
    - TF_INIT_CLI_OPTIONS="-input=false"
    - TF_PLAN_CLI_OPTIONS="-lock=false -input=false"
    - TF_APPLY_CLI_OPTIONS="-auto-approve -input=false"
    - TF_OUTPUT_CLI_OPTIONS=""
    - secure: itE6xn6nRWNOph4uM1VKMfEzE4tX7qJG/O++IUJaNH5/bPi2mJL1SnW/iPrXVn6hgEe/2HJPqiUwKwMMO28qgVo2O9hLprA0eCgoc94LI6bJpf6OMNR6RVoxdnLQu+fTXTZzrprcG7u3V30DrgA15zut4dCe3bpzik2sGraXDjDMjNTFfA/dpjnJoU/R7sJZ9H6GCB4Jt5mwfxNrMcTXSQyX9qtlC4iNqPtyvyDu6Oe8yXqkqtUtAUXLIpUJHn7deKSnFTaLErT6HxcJqiYmMrDJeyWT3yyCb3S+8dWQNNtkVgrz5fEuD0XeweXxvKfVPNkBox7Ge3nx3pXVrNz/8EI8NnF45F1g8r0fH1Ss8hw6v8un5OO+2xhYfiOC3K2JLOJqc8Y45OXh340leRFW2WMbggOkpjx/F7PacPMdv13S3DvTNGGK0O80ErAZVYc6wHdcC795XjRtrwXYhAypX2A7eJoCNDS+Nsuf63ViJtFqgVpiDEc4hO+alj1dO86Zs2ENCR69juYOqJySpF69cmcNfSR6TD2m7Fh8kdYZdlDq5U7h1NbGKGIZKVpPvw6SZluqZzsfWqKc1KwIcVusz5tTRfFDKOHquvLi9lrHOOoBlHHX5CDGIS+TWZIOSW86XRNVrZJSDAtF4l2wkrpwFuerH0Vgz4gXoQpqK8qayO4=
    - secure: TBQ06pX8UkMNYo4XVbzaDKozZxL+VPE1fLTiMKNCdMcKbDMCkt8rYNlrlhxbsxQOddyuf+NQsleTJjnv+6YVofNGkygJpyGo7mAS/FMISvIXGT1/koA348zA52GEYcZX5IPTDZr3N2m7ULp6H/lWbo6+gC6SBhjFXrKG92p13iAKZ1z8D0d+z7LNJY38C7LigG+FC4wWk6CFihiR1iT4/buYRsxtsyW0sucqXUp0kFRcI42kvbsgHKf7m3bAJy8/k4rqk1SXEGvVQge+A2zGwoWtVODGk5xtN40UCPgx2uferYtflNv9xZXWQNbW4u4sWmPPnPuLngpzqxgqry1CQNzZ2qbwdZrCJ5CS3t+nxId5gGAaAvDXv2RPIONF3a8lma5Bnq1A54+Sm3XG+4ClOXYSJvkqA9dhKcLfZbEKbNjro8sPM+hTWgwP2AIhUyqYPLwEZctrtvJRVlLpqNGq4IQxSgCbgB1dGq1pP5bx5pwj0TbfTfFghEsguOJ6lARwsCfKm4hRvpnWAKXcM/aYiTQN7h80YKVyu+Im2t4doXgPYMeCOKCzwfQFDrKeuIY9IK3VrYaMS7eLouawNYrZGP8CkYxJTxYi2c63B8RqugR/xy/qSRRCW6nTyQhu8C0Skv8HFWstVj/ViApj4eAjlIXPe/0DQZ1Im86CMsbS+HQ=
    - secure: pBrcAr2OsPEPyNc9L0oT3f6nntmsPaD7eYotcCZSzdVODPICVC13aAIyOtGrM31KmILEIX3LuuoO9ub64nVKPyU6WqMkRv4jcuXBSs+QmVfZ+3TW1TrM9Dmxnll/o/+LdYWaiZhE0LA9fM86qsgQIhG5BJjMa7buwg/RLEEdrwLGUO+52gCoem6Sel3tEZBCRiUKggnniO+0rS64O/NnaL1VgFmPZql+fFLeEYCHDp4fUTeD1aNL2qaPHIyPYV/LQ+irVW92WWE8S97J9cXuBM1fwuwe20JhDhU7NNV9GWhXnpR0pdDYbF7RVLn/yBy+hvN2KgMKXT5ear1tWsH3nV+UKp1uYCQKR4Ohz7x+uoEhWHV4sMniOL/L53SEiE5nXW4a8Lo8sjr2ki6HZ8YS5yVF567HLt3WlJ40qETtQ+Fzv1Q43vL2cJx4/OXXpM9g+qNTl2bTW2ADAv0fLhN/tEDVgSr/AV5XMI5DfCJCHGoxYZnuRtFHxwJmd7aWDBjY3v9R9Wl9TaEuSozoFEojuHeC54RMXJ+Gs9kz1Eg8PRRGKEIL2V+hIjQBSDZ2NCm4WpopNW93lsd0JficXS2qN9PCIo7WspotOQYfMcur948CmvoFkVkoTKgbGjy1ZmpaxOUEN6ITPEeBcgkPN4MD92RPiFGq2cSqUf9ciS2q+Po=
    - secure: A3w3UjHMpAeV7ujDBHjQYLfoMIRjExmvwTkJgIYoWO0hvG8WamKlMWeQjKeBmixYBQAuNiGjAPFSB79h2me5ginbzHUilI9Lc+1RyVH3P6WGdK1t2DVCPVTGBsfZ+akT6oCQ013GFW69kzebNRKHyxzbdQ+dqM5bIQoqlr6S8HNJutNfe/yhxsVxGzhl+HESJ1E3EmEJJCLZ8wNt40GJP0RMbnm0bBbvcDBntqgYw+SacW1WmrkrhqWHqxg9cYPKVWJLWecokGEWUKegy7pth17XgjDZEd2DAukmQDzPxfVi1RZkwCRHqgJjPIUSLa7tTEyJfPaqeqOw1Da2zAvgD/onl6uCgYDZQM27UgigwMlBwiuaUHD+38bXFbaY28ga4IJQVaddDEGAVmcUJ485UFgGe8nKioI+n5F8I+tai0Mkma7GE5DOLq/etUZBTlH05t7kZgwKqBLeJufHo0lx2UXwjkkTUlaTHmcvfYnKvLINOW5aX02Qzcorbm0E/7Wt0dFvkjdLu/8G2kN0iJPNPgciMm5qxFHXI3F8T6uet9sbJO/WBPE1GsYwt7aPPFvRB1Nc4NU552noCpsyng1Y/ikhBSR7iDzaW+ut+LSA47839tivDn1mNY0yLxJH58Y4n5PBYfk+UOpyAIVDUnEeiz76+OUIOUBA8ppkFtXqvR8=
    - secure: RYD1GRv3Lp8rZX6oJiDjWYH2ABlNyEPzJd+NpSDv4wxtPYHnHg2eXyaoweW+W8hkDm0I+PiMIlTYkCHf2E3o1ICa2F6EoAeCN7uMz+vOtzrnWzBfqi0hCNL4gZhi94MGYXVLRidXSYcr+B8NE0QngsMwHgKknKdHvaEJp3biW7Via4iXTpJURxE36gU8gA4rrVcbY7hj3xA7NzKfPSNRN6S0vuBmLBKsx2tCrEHvm3SK7xjGi83nntWCeoxX1BM6TNP+WSQ6CTQbtttD3XlqI7/bVh/I68ANRYwOVI6FCHIFCSqwiqC9gFo/8ytFrb7goO3E+psT33j4E5uYVOn/2nlMre3r9kO9iMphpVYAV+0PKMd4xyo+HadhePd58B8VbZjI9bZUNRXXQ/DfvLuDeVGbTEXaj26AYoLWGBfwNT8w/lJcKuLZ6QFTT+hIe26RKmQH5n9x8+hODgIaCadOmu247LexCQ8vcLvzESYjRf9RPjywHs4yhfMszWJlQ1Hj4IrgGw34vyWAKpAGaASMyKtPVD0rcYBLL7W92TmIQvaK4/54PQUsvgtVNd+i3Q+zU7RNv8brd0Gv/fznbaIBHtVsAymCEhDx3a/yghbjEYv/VD+lOWVDa3EwuCph2bal0l9l+HKz2BZLLmov+i714UEaloCvabQPLIQg8+T3bPM=
before_install:
  - openssl aes-256-cbc -K $encrypted_e3b08b1bff3b_key -iv $encrypted_e3b08b1bff3b_iv
    -in gcp_keyfile.json.enc -out gcp_keyfile.json -d
  - bash ./scripts/install_terraform
script:
  - terraform init ${TF_INIT_CLI_OPTIONS} tf
  - terraform plan ${TF_PLAN_CLI_OPTIONS} tf
deploy:
  provider: script
  skip_cleanup: true
  on:
    branch: master
  script: terraform apply ${TF_APPLY_CLI_OPTIONS} tf
